app-id: org.gnome.gedit
runtime: org.gnome.Platform
runtime-version: '43'
sdk: org.gnome.Sdk
command: gedit

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --metadata=X-DConf=migrate-path=/org/gnome/gedit/
  # Needed at least for the integrated file browser plugin:
  - --filesystem=host
  # GVfs GIO APIs access using backend URIs
  - --filesystem=xdg-run/gvfsd
  - --talk-name=org.gtk.vfs.*

cleanup:
  - /include
  - /lib/pkgconfig
  - /share/pkgconfig
  - /share/aclocal
  - /man
  - /share/man
  - /share/gtk-doc
  - /share/vala
  - /share/gir-1.0
  - '*.la'
  - '*.a'

modules:
  - name: gedit
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gedit/43/gedit-43.2.tar.xz
        sha256: f950d2d35c594bb6c8dbc9f5440cad7788ca0a8688e2b07846f83de9a4e3fc25
        x-checker-data:
          type: gnome
          name: gedit
          stable-only: true

    modules:
      - name: gspell
        cleanup:
          - /bin
        sources:
          - type: archive
            url: https://download.gnome.org/sources/gspell/1.12/gspell-1.12.0.tar.xz
            sha256: 40d2850f1bb6e8775246fa1e39438b36caafbdbada1d28a19fa1ca07e1ff82ad
            x-checker-data:
              type: gnome
              name: gspell

      - name: libpeas
        buildsystem: meson
        config-opts:
          - -Dlua51=false
          - -Dvapi=true
          - -Ddemos=false
          - -Dglade_catalog=false
        sources:
          - type: archive
            url: https://download.gnome.org/sources/libpeas/1.34/libpeas-1.34.0.tar.xz
            sha256: 4305f715dab4b5ad3e8007daec316625e7065a94e63e25ef55eb1efb964a7bf0
            x-checker-data:
              type: gnome
              name: libpeas

      - name: amtk
        buildsystem: meson
        sources:
          - type: archive
            url: https://download.gnome.org/sources/amtk/5.6/amtk-5.6.1.tar.xz
            sha256: d50115b85c872aac296934b5ee726a3fa156c6f5ad96d27e0edd0aa5ad173228
            x-checker-data:
              type: gnome
              name: amtk

      - name: tepl
        buildsystem: meson
        sources:
          - type: archive
            url: https://download.gnome.org/sources/tepl/6.2/tepl-6.2.0.tar.xz
            sha256: 8cd6865c2c38188760cb38cae33dc9e0a888fad18d0b04f1d55e656aa989a844
            x-checker-data:
              type: gnome
              name: tepl

  - name: gedit-plugins
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gedit-plugins/43/gedit-plugins-43.1.tar.xz
        sha256: 93a4ff0f60e8283293f16c242c25eb197e5e7bdc06cbe8891b82cf1d46cc6e1d
        x-checker-data:
          type: gnome
          name: gedit-plugins

    modules:
      - name: dbus-python
        buildsystem: autotools
        sources:
          - type: archive
            url: https://dbus.freedesktop.org/releases/dbus-python/dbus-python-1.3.2.tar.gz
            sha256: ad67819308618b5069537be237f8e68ca1c7fcc95ee4a121fe6845b1418248f8
            x-checker-data:
              type: anitya
              project-id: 402
              url-template: https://dbus.freedesktop.org/releases/dbus-python/dbus-python-$version.tar.gz

      - name: gucharmap
        buildsystem: meson
        config-opts:
          - -Ducd_path=/app/share/unicode
        sources:
          - type: archive
            url: https://gitlab.gnome.org/GNOME/gucharmap/-/archive/15.0.2/gucharmap-15.0.2.tar.gz
            sha256: 4224479485c137959b9076143a71a22f96946678551f1836592d69d070c47a2d
            x-checker-data:
              type: anitya
              project-id: 1276
              stable-only: true
              url-template: https://gitlab.gnome.org/GNOME/gucharmap/-/archive/$version/gucharmap-$version.tar.gz
        cleanup:
          - /bin
          - /share/help
          - /share/metainfo
        modules:
          - name: unicode-character-database
            buildsystem: simple
            build-commands:
              - install -Dm644 {UCD,Unihan}.zip -t ${FLATPAK_DEST}/share/unicode/
              - bsdtar -xf UCD.zip -C ${FLATPAK_DEST}/share/unicode
              - bsdtar -xf Unihan.zip -C ${FLATPAK_DEST}/share/unicode
            sources:
              - type: file
                url: https://www.unicode.org/Public/zipped/15.0.0/UCD.zip
                sha256: 5fbde400f3e687d25cc9b0a8d30d7619e76cb2f4c3e85ba9df8ec1312cb6718c
                x-checker-data:
                  type: anitya
                  project-id: 17620
                  stable-only: true
                  url-template: https://www.unicode.org/Public/zipped/$version/UCD.zip
              - type: file
                url: https://www.unicode.org/Public/zipped/15.0.0/Unihan.zip
                sha256: 24b154691fc97cb44267b925d62064297086b3f896b57a8181c7b6d42702a026
                x-checker-data:
                  type: anitya
                  project-id: 17620
                  stable-only: true
                  url-template: https://www.unicode.org/Public/zipped/$version/Unihan.zip
            cleanup:
              - '*'

      - name: libgit2-glib
        buildsystem: meson
        config-opts:
          - -Dssh=false
        sources:
          - type: archive
            url: https://download.gnome.org/sources/libgit2-glib/1.1/libgit2-glib-1.1.0.tar.xz
            sha256: c38dd7575daf8141e1e422333a575faf65f3c9210c08e83e981b88dd41bf1ef3
            x-checker-data:
              type: gnome
              name: libgit2-glib
              # TODO: switch to stable in future
              stable-only: false

        modules:
          - name: libgit2
            cleanup:
              - /bin
            buildsystem: cmake
            config-opts:
              - -DCMAKE_BUILD_TYPE=None
              - -Wno-dev
            sources:
              - type: archive
                url: https://github.com/libgit2/libgit2/archive/v1.5.0/libgit2-1.5.0.tar.gz
                sha256: 8de872a0f201b33d9522b817c92e14edb4efad18dae95cf156cf240b2efff93e
                x-checker-data:
                  type: anitya
                  project-id: 1627
                  url-template: https://github.com/libgit2/libgit2/archive/v$version/libgit2-$version.tar.gz

  - name: vte
    buildsystem: meson
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/vte/-/archive/0.70.0/vte-0.70.0.tar.gz
        sha256: ce3bce414ff9515b3dc73b4cea2c252c02355481b6e353c4c3464e3739a54208
