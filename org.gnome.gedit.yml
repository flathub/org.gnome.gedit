app-id: org.gnome.gedit
runtime: org.gnome.Platform
runtime-version: '42'
sdk: org.gnome.Sdk
command: gedit

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --metadata=X-DConf=migrate-path=/org/gnome/gedit/
  # Needed at least for the integrated file browser plugin:
  - --filesystem=host
  # GVfs GIO APIs access using backend URIs
  - --filesystem=xdg-run/gvfsd
  - --talk-name=org.gtk.vfs.*

cleanup:
  - /include
  - /lib/pkgconfig
  - /share/pkgconfig
  - /share/aclocal
  - /man
  - /share/man
  - /share/gtk-doc
  - /share/vala
  - /share/gir-1.0
  - '*.la'
  - '*.a'

modules:
  - name: gedit
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gedit/42/gedit-42.0.tar.xz
        sha256: a87991f42961eb4f6abcdbaabb784760c23aeaeefae6363d3e21a61e9c458437
        x-checker-data:
          type: gnome
          name: gedit
          stable-only: true

    modules:
      - name: gspell
        cleanup:
          - /bin
        sources:
          - type: archive
            url: https://download.gnome.org/sources/gspell/1.8/gspell-1.8.4.tar.xz
            sha256: cf4d16a716e813449bd631405dc1001ea89537b8cdae2b8abfb3999212bd43b4
            x-checker-data:
              type: gnome
              name: gspell

      - name: libpeas
        buildsystem: meson
        config-opts:
          - -Dlua51=false
          - -Dvapi=true
          - -Ddemos=false
          - -Dglade_catalog=false
        sources:
          - type: archive
            url: https://download.gnome.org/sources/libpeas/1.32/libpeas-1.32.0.tar.xz
            sha256: d625520fa02e8977029b246ae439bc218968965f1e82d612208b713f1dcc3d0e
            x-checker-data:
              type: gnome
              name: libpeas

  - name: gedit-plugins
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gedit-plugins/42/gedit-plugins-42.0.tar.xz
        sha256: 7246420fbc3d3950ef78d2e346e21306440e71c64d74f6e8c44e51a58cd0db62
        x-checker-data:
          type: gnome
          name: gedit-plugins

    modules:
      - name: dbus-python
        buildsystem: autotools
        sources:
          - type: archive
            url: https://dbus.freedesktop.org/releases/dbus-python/dbus-python-1.2.18.tar.gz
            sha256: 92bdd1e68b45596c833307a5ff4b217ee6929a1502f5341bae28fd120acf7260
            x-checker-data:
              type: anitya
              project-id: 402
              url-template: https://dbus.freedesktop.org/releases/dbus-python/dbus-python-$version.tar.gz

      - name: gucharmap
        buildsystem: meson
        config-opts:
          - -Ducd_path=/app/share/unicode
        sources:
          - type: archive
            url: https://gitlab.gnome.org/GNOME/gucharmap/-/archive/14.0.3/gucharmap-14.0.3.tar.gz
            sha256: 410b4ff222de5d3c16d47b0c2c268fe03cde1753872a5d5b6c3877a1e87ef284
            x-checker-data:
              type: anitya
              project-id: 1276
              stable-only: true
              url-template: https://gitlab.gnome.org/GNOME/gucharmap/-/archive/$version/gucharmap-$version.tar.gz
        cleanup:
          - /share/help
          - /share/metainfo
        modules:
          - name: unicode-character-database
            buildsystem: simple
            build-commands:
              - install -Dm644 {UCD,Unihan}.zip -t ${FLATPAK_DEST}/share/unicode/
              - bsdtar -xf UCD.zip -C ${FLATPAK_DEST}/share/unicode
              - bsdtar -xf Unihan.zip -C ${FLATPAK_DEST}/share/unicode
            sources:
              - type: file
                url: https://www.unicode.org/Public/zipped/14.0.0/UCD.zip
                sha256: 033a5276b5d7af8844589f8e3482f3977a8385e71d107d375055465178c23600
                x-checker-data:
                  type: anitya
                  project-id: 17620
                  stable-only: true
                  url-template: https://www.unicode.org/Public/zipped/$version/UCD.zip
              - type: file
                url: https://www.unicode.org/Public/zipped/14.0.0/Unihan.zip
                sha256: 2ae4519b2b82cd4d15379c17e57bfb12c33c0f54da4977de03b2b04bcf11852d
                x-checker-data:
                  type: anitya
                  project-id: 17620
                  stable-only: true
                  url-template: https://www.unicode.org/Public/zipped/$version/Unihan.zip
            cleanup:
              - '*'

      - name: libgit2-glib
        buildsystem: meson
        config-opts:
          - -Dssh=false
        sources:
          - type: archive
            url: https://download.gnome.org/sources/libgit2-glib/1.0/libgit2-glib-1.0.0.1.tar.xz
            sha256: 460a5d6936950ca08d2d8518bfc90c12bb187cf6e674de715f7055fc58102b57
            x-checker-data:
              type: gnome
              name: libgit2-glib
              # TODO: switch to stable in future
              stable-only: false

        modules:
          - name: libgit2
            buildsystem: cmake
            config-opts:
              - -DCMAKE_BUILD_TYPE=None
              - -Wno-dev
            sources:
              - type: archive
                url: https://github.com/libgit2/libgit2/archive/v1.4.3/libgit2-1.4.3.tar.gz
                sha256: f48b961e463a9e4e7e7e58b21a0fb5a9b2a1d24d9ba4d15870a0c9b8ad965163
                x-checker-data:
                  type: anitya
                  project-id: 1627
                  url-template: https://github.com/libgit2/libgit2/archive/v$version/libgit2-$version.tar.gz
